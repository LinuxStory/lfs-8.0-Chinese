<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "application/xhtml+xml; charset=UTF-8" />
    <title>
      8.2.&nbsp;创建 /etc/fstab 文件
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-8.0">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version 8.0
      </h4>
      <h3>
        第八章&nbsp;Making the LFS System Bootable
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="introduction.html" title=
          "Introduction">上一页</a>
          <p>
            简介
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="kernel.html" title="Linux-4.9.9">下一页</a>
          <p>
            Linux-4.9.9
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "Chapter&nbsp;8.&nbsp;Making the LFS System Bootable">返回</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version 8.0 ">首页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <h1 class="sect1">
        <a id="ch-bootable-fstab" name="ch-bootable-fstab"></a>8.2. 创建 /etc/fstab 文件
      </h1>
      <p>
        <code class="filename">/etc/fstab</code> 文件用于帮助一些程序确定文件系统的默认挂载点、挂载顺序以及挂载前必须检查其完整性的文件系统。仿照以下格式新建一个文件系统表:
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; /etc/fstab &lt;&lt; "EOF"
<code class="literal"># Begin /etc/fstab

# file system  mount-point  type     options             dump  fsck
#                                                              order

/dev/<em class=
"replaceable"><code>&lt;xxx&gt;</code></em>     /            <em class=
"replaceable"><code>&lt;fff&gt;</code></em>    defaults            1     1
/dev/<em class=
"replaceable"><code>&lt;yyy&gt;</code></em>     swap         swap     pri=1               0     0
proc           /proc        proc     nosuid,noexec,nodev 0     0
sysfs          /sys         sysfs    nosuid,noexec,nodev 0     0
devpts         /dev/pts     devpts   gid=5,mode=620      0     0
tmpfs          /run         tmpfs    defaults            0     0
devtmpfs       /dev         devtmpfs mode=0755,nosuid    0     0

# End /etc/fstab</code>
EOF</kbd>
</pre>
      <p>
        用恰当的值替换 <em class="replaceable"><code>&lt;xxx&gt;</code></em>、
        <em class="replaceable"><code>&lt;yyy&gt;</code></em> 和 <em class=
        "replaceable"><code>&lt;fff&gt;</code></em> 。例如 <code class=
        "filename">sda2</code>、<code class="filename">sda5</code>和
        <code class="systemitem">ext4</code>。关于文件中六个字段的详细含义，请查看 <span class="command"><strong>man 5
        fstab</strong></span>。
      </p>
      <p>
        基于 MS-DOS 或者源于 Windows 的文件系统 (例如： vfat、ntfs、smbfs、cifs、iso9660 和 udf) 需要添加 <span class="quote">&ldquo;<span class=
        "quote">iocharset</span>&rdquo;</span> 挂载项以便在文件名中的非 ASCII 字符能够被正确解析。该项的值应与你区域设置的字符集一致。这样做目的是让内核能够识别它。该项只有在相关的字符集定义已经被编译到内核或者被构建为模块时生效 (在文件系统 -> 本地语言支持中查看）。此外，vfat 和 smbfs 文件系统还需要添加 <span class="quote">&ldquo;<span class="quote">codepage</span>&rdquo;</span> 项。它应该被设置为你的国家 MS-DOS 下使用的代码页编号。例如，为了挂载 USB 闪存设备，ru_RU.KOI8-R 用户将需要在 <code class="filename">/etc/fstab</code> 中它挂载行的 “options” 部分的以下内容：
       </p>
      <pre class="screen"><code class=
"literal">noauto,user,quiet,showexec,iocharset=koi8r,codepage=866</code>
</pre>
      <p>
        ru_RU.UTF-8 用户对应的 “options” 部分内容是：
      </p>
      <pre class="screen">
<code class=
"literal">noauto,user,quiet,showexec,iocharset=utf8,codepage=866</code>
</pre>
      <div class="admon note">
        <img alt="[Note]" src="../images/note.png" />
        <h3>
          注意
        </h3>
        <p>
          在后一种情况中，内核会输出下列信息：
        </p>
        <pre class="screen">
<code class=
"computeroutput">FAT: utf8 is not a recommended IO charset for FAT filesystems,
    filesystem will be case sensitive!</code>
</pre>
        <p>
          我们可以忽略这条信息。因为在 UTF-8 模式下，<span class="quote">&ldquo;<span class=
          "quote">iocharset</span>&rdquo;</span> 选项的其他值都会导致文件名的错误显示。
        </p>
      </div>
      <p>
        同样，对于其他一些文件系统，也可以在内核配置的时候就指定默认的代码页和 “iocharset” 值。相关的参数： <span class="quote">&ldquo;<span class=
        "quote">默认 NLS 选项</span>&rdquo;</span> (<code class=
        "option">CONFIG_NLS_DEFAULT)</code>、 <span class=
        "quote">&ldquo;<span class="quote">默认远程 NLS 选项</span>&rdquo;</span> (<code class=
        "option">CONFIG_SMB_NLS_DEFAULT</code>)、<span class=
        "quote">&ldquo;<span class="quote">FAT 默认代码页</span>&rdquo;</span> (<code class=
        "option">CONFIG_FAT_DEFAULT_CODEPAGE</code>) 、<span class=
        "quote">&ldquo;<span class="quote">FAT 默认 IO 字符集</span>&rdquo;</span> (<code class=
        "option">CONFIG_FAT_DEFAULT_IOCHARSET</code>)。对于 ntfs 文件系统，则无法在内核编译阶段指定这些设置。
      </p>
      <p>
	另外，在 <code class="filename">/etc/fstab</code> 中加入 <code class=
        "option">barrier=1</code> 挂载项可以让 ext3 文件系统的数据在硬盘遭遇电源故障时不容易丢失。（视硬盘类型而定）
	在对应的磁盘驱动器上运行 <a class="ulink" href=
        "http://www.linuxfromscratch.org/blfs/view/8.0/general/hdparm.html">hdparm</a> 可以查看该磁盘驱动器是否支持该选项。
        例如，如果
      </p>
      <pre class="userinput">
<kbd class="command">hdparm -I /dev/sda | grep NCQ</kbd>
</pre>
      <p>
	返回的不是空的输出，就说明支持该选项。
      </p>
      <p>
        注意：Logical Volume Management (LVM) 下的分区不能使用 <code class="option">barrier</code> 选项。
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="introduction.html" title=
          "Introduction">上一页</a>
          <p>
            简介
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="kernel.html" title="Linux-4.9.9">下一页</a>
          <p>
            Linux-4.9.9
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter08.html" title=
          "Chapter&nbsp;8.&nbsp;Making the LFS System Bootable">返回</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version 8.0 ">首页</a>
        </li>
      </ul>
    </div>
  </body>
</html>

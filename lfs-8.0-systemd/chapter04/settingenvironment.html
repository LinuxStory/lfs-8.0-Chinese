<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "application/xhtml+xml; charset=utf-8" />
    <title>
      4.4.&nbsp;配置环境
    </title>
    <link rel="stylesheet" type="text/css" href="../stylesheets/lfs.css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.78.1" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="lfs" id="lfs-8.0-systemd">
    <div class="navheader">
      <h4>
        Linux From Scratch - Version 8.0-systemd
      </h4>
      <h3>
        第四章&nbsp;最后的准备工作
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="addinguser.html" title=
          "添加 LFS 用户">上一页</a>
          <p>
            添加 LFS 用户
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="aboutsbus.html" title="关于时间单位 SBU">下一页</a>
          <p>
            关于时间单位 SBU
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter04.html" title=
          "第四章&nbsp;最后的准备工作">返回</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version 8.0-systemd ">主页</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <h1 class="sect1">
        <a id="ch-tools-settingenviron" name=
        "ch-tools-settingenviron"></a>4.4. 配置环境
      </h1>
      <p>
        通过为 <span class="command"><strong>bash shell</strong></span> 创建两个文件，来建立初始的环境变量。以 <code class="systemitem">lfs</code> 用户登陆，使用以下命令创建新的 <code class="filename">.bash_profile</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; ~/.bash_profile &lt;&lt; "EOF"
<code class=
"literal">exec env -i HOME=$HOME TERM=$TERM PS1='\u:\w\$ ' /bin/bash</code>
EOF</kbd>
</pre>
      <p>
        当以 <code class="systemitem">lfs</code> 用户登陆时， shell 会先读取 <code class="filename">/etc/profile</code> （可能包含一些设置和环境变量），然后读取 <code class= "filename">.bash_profile</code> 。<span class="command"><strong>exec env -i.../bin/bash</strong></span> 命令是用一个空的 shell 替换正在运行的 shell ，并保留 <code class="envar">HOME</code>, <code class="envar">TERM</code> 和 <code class="envar">PS1</code> 变量。这确保了不会引入主机系统中任何不必要的或者具有潜在错误的环境变量到编译环境中去，通过该命令确保了干净的编译环境。
      </p>
      <p>
        如果使用了 <span class="command"><strong>non-login shell</strong></span> ，则不会读取 <code class="filename">/etc/profile</code> 或 <code class="filename">.bash_profile</code> 文件的，而是读取 <code class="filename">.bashrc</code> 文件。立即创建 <code class="filename">.bashrc</code> 文件：
      </p>
      <pre class="userinput">
<kbd class="command">cat &gt; ~/.bashrc &lt;&lt; "EOF"
<code class="literal">set +h
umask 022
LFS=/mnt/lfs
LC_ALL=POSIX
LFS_TGT=$(uname -m)-lfs-linux-gnu
PATH=/tools/bin:/bin:/usr/bin
export LFS LC_ALL LFS_TGT PATH</code>
EOF</kbd>
</pre>
      <p>
        <span class="command"><strong>set +h</strong></span> 命令关闭了 <span class="command"><strong>bash</strong></span> 的哈希功能。一般来说，该功能是一个有用的功能， <span class="command"><strong>bash</strong></span> 通过哈希表记住可执行文件的完整路径，以避免一次又一次的从 <code class="envar">PATH</code> 变量所包含的文件夹中搜索该可执行文件。但是，一旦安装了新的工具，就应该使用新安装的程序代替旧的。通过关闭哈希功能，每次运行一个工具时， shell 就需要在 <code class="filename">$LFS/tools</code> 中找新编译的工具，只要存在新编译的，就不会使用不同路径下同一程序的之前的版本；
      </p>
      <p>
        将用户文件权限的掩码设置为 022 ，确保新创建的文件只能由文件所有者写入，但是可以由任何用户读取和执行（假设使用 <code class="function">open(2)</code> 为系统调用文件的的默认方式，则新文件的权限将为 644 ，新文件夹的权限为 755）。
      </p>
      <p>
        设置 <code class="envar">LFS</code> 变量为安装系统分区的挂载点位置；
      </p>
      <p>
        <code class="envar">LC_ALL</code> 变量控制某些程序的本地化，使程序的输出遵循指定国家/地区的惯例。设置 <code class="envar">LC_ALL</code> 为 <span class="quote">&ldquo;<span class="quote">POSIX</span>&rdquo;</span> 或 <span class="quote">&ldquo;<span class="quote">C</span>&rdquo;</span> （两者是等效的），从而确保一切安装过程按照预期在 chroot 环境中进行。
      </p>
      <p>
        <code class="envar">LFS_TGT</code> 变量设置一个非默认，但是兼容的主机系统描述。这个变量作用于构建交叉编译器和交叉编译临时工具链时使用。更多信息，请参见 <a class="xref" href="../chapter05/toolchaintechnotes.html" title="5.2.&nbsp; 工具链技术说明">5.2.&nbsp;工具链技术说明</a> 。
      <p>
        通过将 <code class="filename">/tools/bin</code> 放在标准 <code class="envar">PATH</code> 目录之前，确保了 <a class="xref" href="../chapter05/chapter05.html" title="第五章&nbsp;构建临时系统">第五章</a> 中安装的程序在安装后可以立即由 shell 调用。结合关闭哈希功能，从而规避了当 <a class="xref" href="../chapter05/chapter05.html" title="第五章&nbsp;构建临时系统">第五章</a> 中提供了新的程序时， shell 依旧调用旧程序的风险；
      </p>
      <p>
        最后，执行下面的命令，让设置的环境变量生效：
      </p>
      <pre class="userinput">
<kbd class="command">source ~/.bash_profile</kbd>
</pre>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="addinguser.html" title=
          "添加 LFS 用户">上一页</a>
          <p>
            添加 LFS 用户
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="aboutsbus.html" title="关于时间单位 SBU">下一页</a>
          <p>
            关于时间单位 SBU
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="chapter04.html" title=
          "第四章&nbsp;最后的准备工作">返回</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Linux From Scratch - Version 8.0-systemd ">主页</a>
        </li>
      </ul>
    </div>
  </body>
</html>
